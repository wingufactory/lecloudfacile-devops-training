# LAB : Exploitation - Rundeck sur Docker 

**üïò : 10 minutes**

## Pr√©sentation

### Objectifs

- Install Rundeck
- Deploiement des services sur docker
- 


### Prerequis

- Connaissance Docker
- Install Docker avec une allocation d'au moins 4G de memoire


## D√©roulement du Lab

### Etape 1: Recuperation du code

```
git clone https://github.com/wingufactory/lecloudfacile-devops-labs.git
cd lecloudfacile-devops-labs/09-exploitation/rundeck
```
ou

```sh
git clone https://github.com/rundeck/welcome-project-community.git
```

le code est fournis par la communaut√© rundeck.

### Etape 2: Analyse du manifeste docker compose
Dans cette √©tape, Nous allons commenter l'utilit√© de chaque instruction du fichier `docker-compose.yaml` 

```yaml
version: '3.8'
services:
    rundeck:
        container_name: rundeck
        build:
          context: rundeck
          args:
            RUNDECK_IMAGE: ${RUNDECK_IMAGE:-rundeck/rundeck:5.6.0}
        links:
          - mysql
        environment:
            RUNDECK_GRAILS_URL: http://localhost:4440
            RUNDECK_DATABASE_DRIVER: org.mariadb.jdbc.Driver
            RUNDECK_DATABASE_USERNAME: rundeck
            RUNDECK_DATABASE_PASSWORD: rundeck
            RUNDECK_DATABASE_URL: jdbc:mariadb://mysql/rundeck?autoReconnect=true&useSSL=false&allowPublicKeyRetrieval=true
            RUNDECK_SERVER_ADDRESS: 0.0.0.0
            RUNDECK_FEATURE_UINEXT_NAME: uiNext
            RUNDECK_FEATURE_UINEXT_ENABLED: 'true'
        ports:
          - 4440:4440
    mysql:
        container_name: mysql
        image: mysql:lts
        expose:
          - 3306
        cap_add:
          - SYS_NICE  # CAP_SYS_NICE reduces error messages in console
        environment:
          - MYSQL_ROOT_PASSWORD=root
          - MYSQL_DATABASE=rundeck
          - MYSQL_USER=rundeck
          - MYSQL_PASSWORD=rundeck
volumes:
  shared-volume:
```


### Etape 3: Demarrage de rundeck

Initialisation de la Base de donn√©es et d√©marrage des services

```bash
docker-compose build
docker-compose up -d
```

### Etape 4: Acc√©der √† l'interface web 

Apr√®s le d√©marrage des services, l'interface Web Airflow est disponible http://localhost:4440

Se connecter avec les credentials : 

```sh
username: admin
password: admin
```
### Etape 5: Creer un projet
Une fois connect√© √† l'interface, cr√©ez votre premier projet

### Etape 6: Manips
Dans le menu, allez dans commandes et choisir un noeud.

une fois, le terminal ouvert vous pouvez passer quelque commandes

### Etape 7: Creer votre premier job
aller dans `traitement` > `nouveau traitement`

Dans `Nom du traitement`, Donner le nom de votre job
`Description`, une description de votre job

![](img/Screenshot%202024-09-27%20at%2022.47.17.png)

Puis aller dans l'onglet `workflow`.
il faut imp√©rativement au moins un step dans le workflow

![](img/Screenshot%202024-09-27%20at%2022.49.11.png)
Dans notre cas nous allons juste executer une commande simple en local (Merci de selectionner `Local Command`)
![](img/Screenshot%202024-09-27%20at%2022.51.08.png)

Ecrivez la commande que vous voulez executer et cliquez sur `sauvegarder`

Une fois la commande cr√©√©e, cr√©ez le job

![](img/Screenshot%202024-09-27%20at%2022.57.05.png)

![](img/Screenshot%202024-09-27%20at%2022.58.06.png)
### Etape 8: FULL CLEAN
Pour nettoyer tous les composants de rundeck ainsi que les images:
```sh
docker-compose down --volume --rmi all
```
