# LAB : Exploitation - Keycloak sur Docker 

**üïò : 10 minutes**

## Pr√©sentation

### Objectifs

- Interpr√©tation de code de deploiement de Keycloak
- Deploiement des services sur docker
- 


### Prerequis

- Conaissance Docker


## D√©roulement du Lab

### Etape 1: Recuperation du code

```
git clone https://github.com/wingufactory/lecloudfacile-devops-labs.git
cd lecloudfacile-devops-labs/09-exploitation/keycloak-on-docker
```

### Etape 2: Analyse du manifeste docker compose
Dans cette √©tape, Nous allons commenter l'utilit√© de chaque instruction du fichier `docker-compose.yaml` 

```yaml

# Indication de la version de l'API

version: '3.8'

# D√©claration liste des services

services:

  # Service keycloak_web

  keycloak_web:

    # Choix de l'image
  
    image: quay.io/keycloak/keycloak:latest

    # Nom du comteneur

    container_name: keycloak_web

    # Definition de quelque variables d'environnement
    environment:
      KC_DB: postgres
      KC_DB_URL: jdbc:postgresql://keycloakdb:5432/keycloak
      KC_DB_USERNAME: keycloak
      KC_DB_PASSWORD: password

      KC_HOSTNAME: localhost
      KC_HOSTNAME_PORT: 8080
      KC_HOSTNAME_STRICT: false
      KC_HOSTNAME_STRICT_HTTPS: false

      KC_LOG_LEVEL: info
      KC_METRICS_ENABLED: true
      KC_HEALTH_ENABLED: true
      KEYCLOAK_ADMIN: admin
      KEYCLOAK_ADMIN_PASSWORD: admin

    # demarre keycloak en mode env dev
    command: start-dev
    
    # Pour indiquer que le service keycloak_web depend du keycloakdb pour bien demarrer correctement

    depends_on:
      - keycloakdb
    
    # Declaration du port keycloak_web et du port d'exposition externe
    ports:
      - 8080:8080


  # Service keycloakdb

  keycloakdb:

    # Choix de l'image
  
    image: postgres:15

    # Montage du volume pour la persitence des donn√©es

    volumes:
      - postgres_data:/var/lib/postgresql/data

    # Definition de quelque variables d'environnement
    environment:
      POSTGRES_DB: keycloak
      POSTGRES_USER: keycloak
      POSTGRES_PASSWORD: password

# Cr√©ation d'un volume nomm√© <postgres_data> pour la persistance des donn√©es. 

volumes:
  postgres_data:
```



### Etape 3: Execution des services

A ce stade, toutes les configurations sont finalis√©es. Il ne reste plus qu'√† d√©marrer les services

- D√©marrage des services

La commande ci-dessous permet de d√©marrer tous les services en arri√®re-plan.

```sh
docker compose up -d
```

- Affichage des conteneurs

```sh
docker ps
```

NB: Certains containers peuvent √©chouer au d√©marrage.


### Etape 4: Test

aller sur votre navigateur et taper le lien suivant: `localhost:8080` pour joindre le dashboard Keycloak

